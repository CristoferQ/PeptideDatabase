<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
<!-- Slider JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js" integrity="sha512-f0VlzJbcEB6KiW8ZVtL+5HWPDyW1+nJEjguZ5IVnSQkvZbwBt2RfCBY0CBO1PsMAqxxrG4Di6TfsCPP3ZRwKpA==" crossorigin="anonymous"></script>
<!-- Slider CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.css" integrity="sha512-SZgE3m1he0aEF3tIxxnz/3mXu/u/wlMNxQSnE0Cni9j/O8Gs+TjM9tm1NX34nRQ7GiLwUEzwuE3Wv2FLz2667w==" crossorigin="anonymous" />



<div class="jumbotron mt-4">
    <h1 class="display-4">Alignment sequences</h1>
    <br>
    <p class="lead">Peptipedia allows the alignment of sequences against its database, using the BlastP tool from the Blast suite. To do this, it is necessary to enter a sequence in Fasta format. The tool takes the sequence and aligns it against the generated database. The results are ordered by percent identity, the first match being the one with the closest phylogenetic relationship.</p>
</div>



<div id="all" class="card">
    <h5 class="card-header">Inputs</h5>
    <div class="card-body">
        <form>
         <div class="form-group">
                <label for="exampleFormControlTextarea1">Sequence in FASTA format</label>
                <textarea class="form-control" id="exampleFormControlTextarea1" rows="8"></textarea>
        </div>
        
        </div>
        <div class="text-center">
            <button id="btn1" type='button' class="btn btn-success btn-lg">Calculate</button>
            <button type='button' class="btn btn-dark btn-lg" onclick="javascript:eraseText();">Clear</button>
        </div>
        </form>
    </div>
    <div hidden id="wait" class="text-center">
    <h2>The results are being processed, this will take a few seconds</h2>
    <i class="fa-5x fas fa-cog fa-spin"></i>
    <br>
    <br>
    </div>
    <h5 id="resultsh5" hidden class="card-header">Results</h5>
    <div id="resultsdiv" hidden class="card-body">
            <div class="table-responsive">
            <table class="table table-dark" id="tabla">
                <thead>
                    <tr>
                    {{!-- <th scope="col">Sequence id</th> --}}
                    <th scope="col">Alignment</th>
                    <th scope="col">Score</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>       
    </div>
</div>







<script>
    $("#btn1").click(function(){
        $('#wait').attr('hidden', false);  
        var now = new Date().getTime();
        $.ajax({
            'url': "http://localhost/alignment/results/?activities1="+$('#activity_lvl_1').selectpicker('val')+"&activities2="+$('#activity_lvl_2').selectpicker('val')+"&activities3="+$('#activity_lvl_3').selectpicker('val')+"&organisms="+all_organism+"&pdb="+pdb+"&uniprot="+uniprot+"&interval="+mySlider.slider('getValue')+"&time="+now,
            'method': "POST",
            'data' : { "sequences" : $("#exampleFormControlTextarea1").val(), "time": now}
        }).done(function(data) {
            console.log(data)
            $('#wait').attr('hidden', true);  
            $('#resultsh5').attr('hidden', false); 
            $('#resultsdiv').attr('hidden', false);
            var keys = Object.keys(data)
            var values = Object.values(data[keys[0]])
            console.log(values)
            for (element in values){
                //console.log(values[element].compare_sequence) //trae los diccionarios por separado
                //console.log(values[element]['compare_sequence']) //trae los valores de la key
                //input_sequence
                //space_format
                $('#tabla').append('<tr id=row'+[element]+'>'+'</tr>');
                
                $('#row'+element).append('<td>'+values[element]['input_sequence']+'</td>');
                $('#row'+element).append('<td>'+values[element]['score_data']+'</td>');
            }
        });

    });

function eraseText() {
    document.getElementById("exampleFormControlTextarea1").value = "";
    $("#exampleFormControlTextarea1").focus();
}
</script>