<div id="wait" class="text-center">
    <h1>The database is loading, this will take a few seconds</h1>
    <br>
    <i class="fa-7x fas fa-cog fa-spin"></i>  
</div>
<div hidden id="all" class="card">
    <h5 class="card-header">Description</h5>
    <div class="card-body">
        <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Molestias explicabo, asperiores sunt vitae enim fugit fugiat. Nisi omnis quam vitae?</p>
    </div>
    <h5 class="card-header">General statistics of the database</h5>
    <div class="card-body">
    <h5 class="card-title">Total number of records:</h5>
    {{#each statistics}}
    <p class="card-text">{{calculation Name 'Total number of records' Value}}</p>
    {{/each}}
    <h5 class="card-title">Total Uniprot codes:</h5>
    {{#each statistics}}
    <p class="card-text">{{calculation Name 'Total Uniprot codes' Value}}</p>
    {{/each}}
    <h5 class="card-title">Total PDB codes:</h5>
    {{#each statistics}}
    <p class="card-text">{{calculation Name 'Total PDB codes' Value}}</p>
    {{/each}}
    <h5 class="card-title">Total number of organism:</h5>
    {{#each statistics}}
    <p class="card-text">{{calculation Name 'Total number of organism' Value}}</p>
    {{/each}}
  </div>

    <h5 class="card-header">Pie Chart of the number of sequences per activity</h5>
    <div class="card-body">
        <div id="pie1"></div>
    </div>
    <h5 class="card-header">Histogram of the lenght of total sequences</h5>
    <div class="card-body">
        <div id="hist1"></div>
    </div>
    <h5 class="card-header">Database</h5>
    <div class="card-body">
        <a id="dl_csv" target="_blank" class="btn btn-secondary btn-lg">Download in CSV</a>
        <a id="dl_json" target="_blank" class="btn btn-secondary btn-lg">Download in JSON</a>
        <a id="dl_fasta" target="_blank" class="btn btn-secondary btn-lg">Download in FASTA</a>
        <br>
        <br>
        <table id="example" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th>Sequence</th>
                        <th>View more</th>
                        <th>Length</th>
                        <th>Uniprot_code</th>
                        <th>Pdb_code</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th>Sequence</th>
                        <th>View more</th>
                        <th>Length</th>
                        <th>Uniprot_code</th>
                        <th>Pdb_code</th>
                    </tr>
                </tfoot>
            </table>  
    </div>
    <h5 class="card-header">Average property values ​​for each activity</h5>
    <div class="card-body">
        <table class="table-responsive table-striped px-3 py-3">
            <thead>
                <tr>
                <th class="px-2 py-2" scope="col">Property</th>    
                {{#each statistics}}
                <th class="px-2 py-2" scope="col">{{matrix Name Name}}</th>                
                {{/each}}
                </tr>
            </thead>
            <tbody>
                <tr>
                <th class="px-2 py-2" scope="row">Molecular Weigth</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 0}}</td>
                {{/each}}
                </tr>
                <tr>
                <th class="px-2 py-2" scope="row">Charge</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 1}}</td>
                {{/each}}
                </tr>
                <tr>
                <th class="px-2 py-2" scope="row">Charge Density</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 2}}</td>
                {{/each}}
                </tr>
                <tr>
                <th class="px-2 py-2" scope="row">Isoelectric</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 3}}</td>
                {{/each}}
                </tr>
                <tr>
                <th class="px-2 py-2" scope="row">Inestability</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 4}}</td>
                {{/each}}
                </tr>
                <tr>
                <th class="px-2 py-2" scope="row">Aromaticity</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 5}}</td>
                {{/each}}
                </tr>
                <tr>
                <th class="px-2 py-2" scope="row">Aliphatic Index</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 6}}</td>
                {{/each}}
                </tr>
                <tr>
                <th class="px-2 py-2" scope="row">Hydrophobic Ratio</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 7}}</td>
                {{/each}}
                </tr>
                <tr>
                <th class="px-2 py-2" scope="row">Hydrophobicity Profile</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 8}}</td>
                {{/each}}
                </tr>
                <tr>
                <th class="px-2 py-2" scope="row">Hydrophobic Profile</th>
                {{#each statistics}}
                <td class="px-2 py-2">{{calculation_matrix Name Mean 9}}</td>
                {{/each}}
                </tr>
            </tbody>
        </table>
    </div>
    <h5 class="card-header">Activities</h5>
    <div class="card-body">
        <div class="row mb-2">
        {{#each activities}}
        <div class="card col-3">
                <div class="card-body">
                    <h5 class="card-title activity_names">{{matrix Name Name}}</h5>
                    <p class="card-text">{{matrix Name Description}}</p>
                    <a id="{{matrix Name Name}}" class="btn btn-primary" onclick="myFunction(this)" >See details</a>
                </div>
            </div>
        {{/each}}
        </div>
    </div>
</div>
<script>
  function myFunction(elem) {
        //location.href = 'details?activity='+elem.id;
        if(elem.id == 'Signal Peptide'){
            elem.id = 'SignalPeptide'
        }
        location.href = 'details/'+elem.id;
    } 
  var strings = ("{{#each statistics}}{{calculation Name 'PieChart1' Labels}}{{/each}}");
  var array = strings.split(",");
  var data = [{
  values:   [{{#each statistics}}{{calculation Name 'PieChart1' Value}}{{/each}}],
  labels: array,
  type: 'pie'
}];

Plotly.newPlot('pie1', data);


var trace = {
    x: [{{#each statistics}}{{calculation Name 'Histogram1' Value}}{{/each}}],
    type: 'histogram',
  };
var data = [trace];
Plotly.newPlot('hist1', data);


$.ajax({
    'url': "http://localhost/api/database",
    'method': "GET",
    'contentType': 'application/json'
}).done( function(data) {
    var example = $('#example').DataTable( {
        "scrollX": true,
        "aaData": data,
        "columns": [
            { "data": "sequence" },
            { "defaultContent": "<button id='b_results' type='button' class='btn btn-success'><i class='fa fa-file'></i></button>"},
            { "data": "length" },
            { "data": "uniprot_code" },
            { "data": "pdb_code" }
        ]
    })    
    
    var dlAnchorElem = document.getElementById('dl_csv');
    dlAnchorElem.setAttribute("href", 'attachment/database.csv');
    dlAnchorElem.setAttribute("download", "database.csv");
    
    var dlAnchorElem = document.getElementById('dl_json');
    dlAnchorElem.setAttribute("href", 'attachment/database.json');
    dlAnchorElem.setAttribute("download", "database.json");

    var dlAnchorElem = document.getElementById('dl_fasta');
    dlAnchorElem.setAttribute("href", 'attachment/database.fasta');
    dlAnchorElem.setAttribute("download", "database.fasta");

    $('#wait').attr('hidden', true);
    $('#all').attr('hidden', false);  
    $('#example').DataTable().columns.adjust();
    getSecForDetail("#example tbody", example);
});
var getSecForDetail = function(tbody, table){
    $(tbody).on("click", "#b_results", function(){
		var data = table.row( $(this).parents("tr") ).data();		
        if (data != undefined){
            window.open("../sequence?sec="+data.sequence, "_blank");
            //location.href="../sequence?sec="+data.sequence;
        }
	});
}
</script>

